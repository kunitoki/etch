// Regression test for loop optimizer transformations
// This reproduces the example that previously hung in optimized builds.

fn filter(arr: array[int], predicate: fn(int) -> bool) -> array[int] {
    var res: array[int] = [];

    var i = 0;
    while i < #arr {
        if predicate(arr[i]) {
            res = res + [arr[i]];
        }
        i = i + 1;
    }

    return res;
}

fn greaterThanFive(x: int) -> bool {
    return x > 5;
}

fn main() {
    let numbers = [1, 3, 6, 8, 2, 9, 4, 7];

    // Using named function with UFCS-style filter
    let filtered = filter(numbers, greaterThanFive);
    print("filter greater than 5: count = " + string(#filtered));

    // Using inline lambda with UFCS-style filter
    let even = filter(numbers, |x: int| x % 2 == 0);
    print("filter even numbers: count = " + string(#even));

    // Using lambda with capture
    let threshold = 4;
    let aboveThreshold = filter(numbers, [threshold] |x: int| x > threshold);
    print("filter above threshold " + string(threshold) + ": count = " + string(#aboveThreshold));
}
