// Test destructor with nested scopes

type Resource = object {
  id: int;
};

fn ~(r: Resource) -> void {
  print("Destructor called for Resource #" + string(r.id));
}

fn createAndUse(id: int) -> void {
  print("Creating resource " + string(id));
  let res = new[Resource]( id: id );
  discard res;
  print("Exiting scope for resource " + string(id));
}

fn main() -> void {
  print("Starting test...");
  createAndUse(1);
  createAndUse(2);
  createAndUse(3);
  print("All scopes exited");
}
